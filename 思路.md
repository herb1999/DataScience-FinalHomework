# 对于Python初学者的OJ平台学习推荐研究

## 一、摘要

Python编程语言简洁、易读、易入门，且拥有丰富的库。大部分的Python初学者只学会基本语法就开始编程,因此需要在练习中学习更多的方法、语法糖等，以提高代码的效率和可读性。本文将为Python初学者在OJ平台上的编程练习实现一种推荐策略，包括学生源码评分、源码方法和语法糖统计、学生做题前的标签推荐、做题后的代码推荐，以及针对用例编程的异常检测，并分析该策略所涉及领域的国内外研究成果。

## 二、关键词

python，代码评分，代码相似度度量，异常检测, 代码推荐

## 三、正文

### 1.研究背景

Python遵循“简单、优雅、明确”的设计哲学，“Beautiful is better than ugly, simple is better than complex”。Python易学、易读、易入门，因而非常适合初学者。同时，Python还拥有大量的库，在统计、AI、系统测试、Web编程等等领域有者广泛应用。从2019年1月至2020年1月，TIOBE排行榜中Python一直占据前三^[1]^，在大学校园，Python成为最受欢迎的教学语言之一。

但是，正因为Python容易入门，Python初学者可能没有兴趣一口气学完所有的方法和技巧，而是只学会基本语法就开始编程,因此代码质量参差不齐，需要在编程练习中学习更多的方法、语法糖等，以提高代码的效率和可读性。

以南京大学软件学院学生在数据科学课程OJ平台上提交的代码为例，对其部分特性，如代码行数和运行时间进行分析，可以发现不同学生的代码在效率、可读性上具有显著差异（见图1.1，图1.2）。通过阅读源码，发现其差异主要由方法、语法糖、算法的不同选择造成。

- 图1.1
  [![t6hmnS.png](https://s1.ax1x.com/2020/06/06/t6hmnS.png)](https://imgchr.com/i/t6hmnS)

- 图1.2
  [![t6hitA.png](https://s1.ax1x.com/2020/06/06/t6hitA.png)](https://imgchr.com/i/t6hitA)

在通过大量的python练习题提高学生编程能力的过程中，会有这样的问题：
  - 1.是先深入学习算法、方法等，还是先做题？
    - 先学习：作业时间紧张，学过后不加以实践则容易遗忘。
    - 先做题：耗时耗力，已有知识不足，完成代码质量差，起不到练习的效果。
    - 边做边学：更加合理，但是学生需要知道应该先学哪些方法来解决问题。
  - 2.因此，在学生边做边学的时候，我们希望可以为其提供学习推荐，但是推荐到什么程度是合适的？
    - 完整的优秀代码推荐：不能在学生做题前推荐，不然学生没有自己练习的动力。
    - 代码片段推荐：缺少上下文，学生难以理解。
    - 这一道题可以用到的算法、方法、语法糖推荐：可以缩小需要学习的范围，让学生自己去学，即学即用。

因此，我想做的是，针对python初学者（如大一新生）在OJ平台做的每一道练习题，在学生做题前，进行python进阶方法、语法糖、算法推荐，在学生做题全部通过后，进行完整优秀代码推荐，逐步提高其代码的效率和可读性。

### 2.技术路线
首先从OJ平台收集学生练习代码；对同一问题的不同代码进行评分；保留全用例通过，且代码质量评分较高的代码作为推荐代码（用异常检测、结构分析剔除针对测试用例的代码）。对推荐代码做方法/语法糖使用情况统计，记录其中被使用较多的，在学生做题前，推荐学生先去学习这些方法/语法糖。在学生做题后，对学生提交的代码和推荐代码进行相似度度量，分别选择与学生提交代码最相似和最不相似的代码进行完整代码推荐。

#### 2.1.数据集获取
数据集来自南京大学软件学院数据科学课程的OJ平台python练习题数据，每个学生在大部分初步入门Python的情况下完成了200道难度不等的练习题，数据包括题目、可通过的示例代码、学生提交的源码、每次提交的时间和成绩。

#### 2.2.代码评分

//todo-1:**代码容量**，**嵌套深度**（运行时间应该可以代替？）

//多整些特征，之后好做**降维**，完成任务

业界的代码评分需要考虑很多特征，如需求覆盖率、bug数量、代码复用率、代码量、性能、安全性、编写规范等，并且拥有许多用于保证代码质量的检查器，如用于Python评分的 flake8、black 、mypy和pylint。但是，他们可能并不适用于OJ平台上的竞赛题、练习题编程，针对这些题目的代码往往没有很多的方法、类，也没有团队合作的需求，因此对他们的评分策略需要做一些改变。

目前已实现的评分策略是结合**测试用例通过量、代码行数、测试用例运行时间、关键词的数量(如for,while)**等，对各个特征加权得到评分。

//工作量较大，，或者不做，**能不能找到第三方库**，**分析提交是否线性增加**。

之后可以通过比较学生代码和每个题目的示例代码之间的相似度进行评分，将学生代码和示例代码转换为抽象语法树的中间表示，以提取程序的详细结构信息^[3]^，将学生代码的算法、方法纳入考量，保证之后的推荐代码有较高价值。

//不使用相似度度量，则需要异常检测--情况有些复杂，有的题大部分都是面向用例，异常检测不适用。。。先搁置吧

另外，部分同学会“面向测试用例编程”，即用if-else判断来通过测试用例，达不到练习效果。这部分代码需要使用异常检测进行剔除（以代码行数、测试用例运行时间、关键词的数量分析等作为特征），或者在采用比较学生代码和每个题目的示例代码之间的相似度进行评分后，因“面向测试用例编程”代码结构特殊而评分过低，被自动剔除。

#### 2.3.方法/语法糖统计
将全用例通过，且代码质量评分较高的代码作为推荐代码。通过查找模块、关键词来统计代码中方法的使用情况，通过关键词和正则匹配来统计代码中语法糖的使用情况。

#### 2.4.学生做题前的标签推荐：

//todo:探索方法之间的**关联规则**

在学生做题前，可以将推荐代码中使用较多的方法/语法糖作为标签附在题目上，推荐学生先行学习。因为该推荐策略首先需要足够的训练数据，且可能推荐学习内容不够全面（如暂时没有推荐需要学习的算法），作为补充，教师/助教也可以指定一些标签，完成题目的学生也可以为一道题人为创建新的标签并投票，加入到推荐标签中。

//**类似题目推荐**？工作量还好，但是这个方向有点散，暂时先不考虑

此外，还可以将一道题目的所有标签作为特征，对所有题目进行聚类分析，作为题目分类的依据。这样分类可以使得学生集中练习强化某一部分算法、方法的使用。

1 3 5

2 3 5

1，0，1，0，1

0，1，1，0，1

#### 2.5.学生做题后的代码推荐：

//如果工作中心放在方法、语法糖的推荐上，就先用方法、语法糖等作为特征进行相似度度量

在学生完成题目后，对学生提交的代码和步骤2.3中选出的推荐代码进行相似度度量。

//距离最远或聚类推荐，降维？

前期可以将学生代码使用的方法、语法糖等作为特征，和推荐代码的同类特征进行相似度度量，分别选择与学生提交代码最相似（检查当前代码的思路有没有提升空间）和最不相似的代码（提供新的思路）进行推荐。

后期可以考虑借鉴孙广中等人的C语言程序竞赛题分类方法^[4]^，对推荐代码的抽象语法树提取特征，进行多分类学习，得到分类模型；再利用分类模型对学生新提交的代码自动分类，推荐不同类别的代码。

南京大学计算机科学系的Needle教学工具把学生代码的相似度建模成一个二分图的最大权匹配问题^[5]^，将代码的结构性特征也纳入相似度的度量，也具有借鉴意义。

对于代码相似度度量，国内外已有很多研究，一部分目的在于防止剽窃，另一部分则是为了代码推荐，从最初的属性计数法（如运算符个数、操作数个数、变量 类型等属性）^[6]^，到分析程序的控制流，再到将数据依赖、控制结构等纳入考量，目前的相似度度量算法结合了属性计数和结构度量两方面的信息。

为了应对目前逐渐增大的代码规模，机器学习方法也被应用在相似度度量中，结合了一部分NLP的特性。有使用N-gram方法的基于关键词的度量，有使用词向量的基于向量空间的方法，以及使用深度学习的方法。

本项目研究的OJ平台的学生代码有代码量小、使用的方法和算法范围小、方法和算法一定程度上关联代码结构等特点，因此决定采用前述的方法进行相似度度量。



## 四、参考文献

[1]https://www.tiobe.com/tiobe-index/

[2]https://ai.facebook.com/blog/aroma-ml-for-code-recommendation/


[3]马培军,王甜甜,苏小红.基于程序理解的编程题自动评分方法[J].计算机研究与发展,2009,46(07):1136-1142.

[4]中国科学技术大学.对程序竞赛型源代码按照解题方法做自动分类与评分的方法:CN201710883195.2[P].2018-02-23.

[5]Yanyan Jiang, and Chang Xu. Needle: Detecting Code Plagiarism on Student Submissions. In SIGCSE China, 2018.

[6]Remoortere P V . Elements of software science : M.H. Halstead: Published by North Holland Amsterdam and N.Y. 1977, 128 pages, US $ 18.95. ISBN 0-444-00205-7[J]. mathematics & computers in simulation, 1979, 21(4):387-0.

