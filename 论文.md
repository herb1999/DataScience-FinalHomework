# 对于Python初学者的OJ平台学习推荐研究

==可以从思路.md修改后搬过来==

## 一、摘要

> 这个先不用写

## 二、关键词

python，代码评分，代码相似度度量，异常检测, 代码推荐

## 三、正文

### 1.研究背景

> 图片要改，大家看看用什么样的图和数据可以说明Python初学者存在的问题，说明我们的研究的必要性



### 2.技术路线
> 1. 包含简略的迭代过程，如“代码行数”--“代码容量”、k-means的k值优化

以单一题目为单位

#### 2.1.数据集获取

数据集来自南京大学软件学院数据科学课程的OJ平台python练习题数据，每个学生在大部分初步入门Python的情况下完成了200道难度不等的练习题，数据包括题目ID、题目描述、可通过的示例代码、学生提交的代码、每次提交的时间和成绩、测试用例。

学生代码被下载并解压到对应的cases/题目ID/学生代码ID文件夹中，题目附带的答案代码(answer.py)将和学生代码一同研究，被存放到cases/题目ID/0 文件夹中（方便起见，之后统称为学生代码）。

（图1）

![image-20200727194613453](C:\Users\18250\Desktop\笔记\数科大作业学习笔记\image-20200727194613453.png)

由于本课题以python编程为研究目标，在获取学生代码的过程中根据 properties 文件排除了非python语言的代码。

#### 2.2.代码评分

我们通过调查发现，业界的代码评分需要考虑很多特征，如需求覆盖率、bug数量、代码复用率、代码量、性能、安全性、编写规范等，并且拥有许多用于保证代码质量的检查器，如用于Python评分的 flake8、black 、mypy和pylint。但是，他们可能并不适用于OJ平台上的竞赛题、练习题编程，针对这些题目的代码往往没有很多的模块、类、注释，也没有团队合作的需求，因此对他们的评分策略需要做一些改变。

本课题实现的评分策略是：获取代码的测试用例通过情况、代码容量（Helstead方法）、代码通过测试用例的运行时间和内存占用、for/while循环嵌套深度等，**对各个特征加权得到评分**（待修改）。

##### 2.2.1 测试

首先，我们对一道题目中的所有学生代码，依次使用测试用例的输入进行测试，获取其运行时间、内存占用（使用memory_profiler）、输出。

（==图2  测试结果==）

我们接着去除代码的所有空行、注释（单行注释、多行注释、代码行后的注释），使用Helstead方法（==找一下原论文==）统计代码容量：设代码中操作符的种类为n~1~，数量为N~1~，操作数的种类为n~2~，数量为N~2~，程序的词汇量n=n~1~+n~2~, 程序长度 N=N~1~+N~2~.  程序容量V

==公式1==

![image-20200727174136490](C:\Users\18250\Desktop\笔记\数科大作业学习笔记\image-20200727174136490.png)

另外，利用python代码强制缩进的特性，我们测量了代码的for/while循环嵌套深度。

部分同学还会“面向测试用例编程”，即用if-else判断来通过测试用例，对于之后的推荐有干扰。

（图3）

![image-20200727195004680](C:\Users\18250\Desktop\笔记\数科大作业学习笔记\image-20200727195004680.png)

因为这里不是课题重点，我们进行了一个较为简单的检测：设测试用例的预期输出为output，我们检查了学生代码中有没有print('output') 或 print(”output“) ，因为大部分的“面向用例编程”的代码都会这样输出，且正常的学生代码不会这样输出。我们在自动检查后进行了人工复查，发现查准率与查全率都很高，满足使用需求。例如，ID为2176的题目，共135份学生代码，查出23份“面向用例编程”代码，经复查，“正常代码”和“面向用例编程”代码均判断无误（==复查一下==）。

（图4  对2176题的测试）

![image-20200727195115948](C:\Users\18250\Desktop\笔记\数科大作业学习笔记\image-20200727195115948.png)

（图5  对于一部分是正常代码，一部分“面向用例编程”的代码也可以检查出来）

![image-20200727180026923](C:\Users\18250\Desktop\笔记\数科大作业学习笔记\image-20200727180026923.png)

##### 2.2.2 评分

> 待定，归一化+PCA

在评分之前，我们先剔除掉未能通过所有测试用例，或者“面向用例编程”的代码，以提高之后推荐的质量。



#### 2.3.方法/函数统计

该阶段对学生代码的方法/函数统计以及上阶段的评分，将一起作为之后的标签推荐和代码推荐的依据。

##### 2.3.1. 统计范围

在OJ平台上的竞赛题、练习题编程中，学生常用的方法/函数有：Python的内置函数（方便起见，下面统一记为“std”库）、常用库的函数、常用类的方法。

通过正则表达式对大量学生代码的分析，我们找出了学生常用的库、函数等，以此为依据建立了一张常用库和常用类的方法/函数参照表。

（图6  libs.csv）

![image-20200727194504614](C:\Users\18250\Desktop\笔记\数科大作业学习笔记\image-20200727194504614.png)

##### 2.3.2. 统计过程

我们检测了可能遇到的库引入形式：import ... , from ... import ..., import ... as ..., from ... import ... as ... , from ... import *  , 对于用as设置了别名的库、函数，进行了额外的映射。

先统计出代码使用的库，接着通过查询上述参照表，统计出代码使用了库的什么函数，以<库名>.<函数名>标记。我们默认代码使用了内置函数（记为std库）和常用类——不太好统计代码使用的类，因为参照表中的常用类没有重名的函数/方法，所以默认代码使用了所有常用类，在统计中对于<操作数>.<方法>的情况，根据方法名推断类名。

（图7 ： 2307题统计结果）

![image-20200727202748291](C:\Users\18250\Desktop\笔记\数科大作业学习笔记\image-20200727202748291.png)

另外，学生还可能在引入库/函数之后，定义了同名的函数或变量，我们对这一情况进行了排除。

对于一个代码，我们认为有没有使用一个方法/函数是主要因素，使用了几次这个方法/函数是次要因素，因此通过sigmoid函数将统计结果控制在 [0,1)  

==公式2==   x为方法/函数使用次数

![image-20200727204036317](C:\Users\18250\Desktop\笔记\数科大作业学习笔记\image-20200727204036317.png)



#### 2.4.学生做题前的标签推荐：

> 1.PCA降维
>
> 2.k-means聚类——k值优化
>
> 3.我们注意到聚类结果与评分的关联性->
>
> 4.取评分最优的一类的标签（感觉其他类的标签也可以用，放在后面推荐就可以了）
>
> 5.取得各个类中评分最好的代码的路径，为下一步做准备

#### 2.5.学生做题后的代码推荐：

> 1.取上一步得到的代码，再加上题目提供的答案代码，全部与学生新提交的代码进行相似度度量
>
> 2.按照相似度从低到高进行推荐（相似度越低，可学习得地方越多，最好给一个例子）

## 四、成果展示

> 网站展示，可以作为ppt、视频的底稿

## 五、参考文献

[1]https://www.tiobe.com/tiobe-index/

[2]https://ai.facebook.com/blog/aroma-ml-for-code-recommendation/


[3]马培军,王甜甜,苏小红.基于程序理解的编程题自动评分方法[J].计算机研究与发展,2009,46(07):1136-1142.

[4]中国科学技术大学.对程序竞赛型源代码按照解题方法做自动分类与评分的方法:CN201710883195.2[P].2018-02-23.

[5]Yanyan Jiang, and Chang Xu. Needle: Detecting Code Plagiarism on Student Submissions. In SIGCSE China, 2018.

[6]Remoortere P V . Elements of software science : M.H. Halstead: Published by North Holland Amsterdam and N.Y. 1977, 128 pages, US $ 18.95. ISBN 0-444-00205-7[J]. mathematics & computers in simulation, 1979, 21(4):387-0.

